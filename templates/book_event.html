<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Event - EventHive</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --accent: #f72585;
      --success: #4cc9f0;
      --warning: #f9c74f;
      --danger: #f94144;
      --dark: #2b2d42;
      --light: #f8f9fa;
      --gray-100: #f8f9fa;
      --gray-200: #e9ecef;
      --gray-300: #dee2e6;
      --gray-400: #ced4da;
      --gray-500: #adb5bd;
      --gray-600: #6c757d;
      --gray-700: #495057;
      --gray-800: #343a40;
      --gray-900: #212529;
      --border-radius: 12px;
      --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.05), 0 6px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f5f7fb;
      color: var(--gray-800);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
    }

    .logo-icon {
      margin-right: 10px;
      font-size: 2rem;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-name {
      font-weight: 600;
      color: var(--gray-700);
    }

    .btn-back {
      display: inline-flex;
      align-items: center;
      padding: 0.7rem 1.5rem;
      background-color: var(--gray-200);
      color: var(--gray-700);
      text-decoration: none;
      border-radius: var(--border-radius);
      font-weight: 600;
      transition: var(--transition);
    }

    .btn-back:hover {
      background-color: var(--gray-300);
      transform: translateX(-3px);
    }

    /* Main Content */
    .booking-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 768px) {
      .booking-container {
        grid-template-columns: 1fr;
      }
    }

    /* Event Info Card */
    .event-card {
      background-color: white;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .event-image {
      height: 200px;
      overflow: hidden;
    }

    .event-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .event-info {
      padding: 1.5rem;
    }

    .event-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--dark);
    }

    .event-details {
      margin-bottom: 1.5rem;
    }

    .event-detail {
      display: flex;
      align-items: center;
      margin-bottom: 0.8rem;
      color: var(--gray-700);
    }

    .event-detail i {
      margin-right: 0.8rem;
      color: var(--primary);
      width: 20px;
    }

    .event-description {
      color: var(--gray-600);
      line-height: 1.6;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--gray-200);
    }

    /* Booking Form */
    .booking-form {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
    }

    .form-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--dark);
      display: flex;
      align-items: center;
    }

    .form-title i {
      margin-right: 0.5rem;
      color: var(--primary);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--gray-700);
    }

    .form-group select, .form-group input {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius);
      font-family: 'Montserrat', sans-serif;
      font-size: 0.95rem;
      transition: var(--transition);
    }

    .form-group select:focus, .form-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    .ticket-option {
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius);
      padding: 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .ticket-option:hover {
      border-color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .ticket-option.selected {
      border-color: var(--primary);
      background-color: rgba(67, 97, 238, 0.05);
    }

    .ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .ticket-name {
      font-weight: 600;
      color: var(--dark);
    }

    .ticket-price {
      font-weight: 700;
      color: var(--primary);
    }

    .ticket-details {
      font-size: 0.9rem;
      color: var(--gray-600);
      margin-bottom: 0.5rem;
    }

    .ticket-availability {
      font-size: 0.85rem;
      color: var(--gray-500);
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      margin-top: 1rem;
    }

    .quantity-btn {
      width: 36px;
      height: 36px;
      border: 1px solid var(--gray-300);
      background: white;
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .quantity-btn:hover {
      background-color: var(--gray-100);
    }

    .quantity-input {
      width: 50px;
      height: 36px;
      border: 1px solid var(--gray-300);
      border-left: none;
      border-right: none;
      text-align: center;
      margin: 0 0.5rem;
    }

    .promo-section {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--gray-200);
    }

    .promo-input {
      display: flex;
      gap: 0.5rem;
    }

    .promo-input input {
      flex: 1;
    }

    .apply-promo {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      padding: 0 1rem;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .apply-promo:hover {
      background-color: var(--secondary);
    }

    .summary {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--gray-200);
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .summary-total {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      font-size: 1.1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--gray-300);
    }

    .btn-book {
      display: block;
      width: 100%;
      padding: 1rem;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 1.5rem;
    }

    .btn-book:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
    }

    .btn-book:disabled {
      background: var(--gray-400);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <span class="logo-icon">ðŸŽ©</span>
        EventHive
      </div>
      <div class="user-menu">
        <span class="user-name">Hello, {{ session.user }}</span>
        <a href="{{ url_for('dashboard') }}" class="btn-back">
          <i class="fas fa-arrow-left"></i> Back to Events
        </a>
      </div>
    </div>

    <!-- Booking Container -->
    <div class="booking-container">
      <!-- Event Info -->
      <div class="event-card">
        <div class="event-image">
          <img src="{{ url_for('static', filename='images/' ~ (event.image if event.image else 'default.jpg')) }}" alt="{{ event.name }}">
        </div>
        <div class="event-info">
          <h1 class="event-title">{{ event.name }}</h1>
          
          <div class="event-details">
            <div class="event-detail">
              <i class="fas fa-map-marker-alt"></i>
              <span>{{ event.location }}</span>
            </div>
            
            <div class="event-detail">
              <i class="fas fa-tag"></i>
              <span>{{ event.category }}</span>
            </div>
            
            <div class="event-detail">
              <i class="fas fa-calendar-day"></i>
              <span>{{ event.start_date.strftime('%A, %B %d, %Y') }}</span>
            </div>
            
            <div class="event-detail">
              <i class="fas fa-clock"></i>
              <span>{{ event.start_date.strftime('%I:%M %p') }} - {{ event.end_date.strftime('%I:%M %p') }}</span>
            </div>
          </div>

          <div class="event-description">
            <p>{{ event.description }}</p>
          </div>
        </div>
      </div>

      <!-- Booking Form -->
      <div class="booking-form">
        <h2 class="form-title">
          <i class="fas fa-ticket-alt"></i> Select Tickets
        </h2>

        <form method="POST" action="{{ url_for('book_event_with_tickets', event_id=event.id) }}">
          <div class="form-group">
            <label>Available Ticket Types</label>
            
            {% for ticket in ticket_types %}
            <div class="ticket-option" onclick="selectTicket({{ ticket.id }})" id="ticket-{{ ticket.id }}">
              <div class="ticket-header">
                <div class="ticket-name">{{ ticket.name }}</div>
                <div class="ticket-price">â‚¹{{ "%.2f"|format(ticket.price) }}</div>
              </div>
              <div class="ticket-details">
                {% if ticket.sale_start and ticket.sale_end %}
                Sale: {{ ticket.sale_start.strftime('%b %d') }} - {{ ticket.sale_end.strftime('%b %d') }}
                {% endif %}
              </div>
              <div class="ticket-availability">
                {{ ticket.quantity }} tickets available â€¢ Max {{ ticket.max_per_user }} per person
              </div>
              
              <div class="quantity-selector" id="quantity-{{ ticket.id }}" style="display: none;">
                <div class="quantity-btn" onclick="decreaseQuantity({{ ticket.id }})">-</div>
                <input type="number" class="quantity-input" id="qty-{{ ticket.id }}" name="ticket_{{ ticket.id }}_qty" value="1" min="1" max="{{ ticket.max_per_user }}" onchange="updateQuantity({{ ticket.id }}, this.value)">
                <div class="quantity-btn" onclick="increaseQuantity({{ ticket.id }})">+</div>
              </div>
            </div>
            {% else %}
            <div class="ticket-option">
              <div class="ticket-header">
                <div class="ticket-name">No tickets available</div>
              </div>
              <div class="ticket-details">
                Check back later for ticket availability.
              </div>
            </div>
            {% endfor %}
            
            <input type="hidden" id="selected_ticket" name="ticket_type_id" value="">
            <input type="hidden" id="ticket_quantity" name="quantity" value="1">
          </div>

          <div class="promo-section">
            <label>Promo Code (Optional)</label>
            <div class="promo-input">
              <input type="text" name="promo_code" placeholder="Enter promo code">
              <button type="button" class="apply-promo">Apply</button>
            </div>
          </div>

          <div class="summary">
            <div class="summary-item">
              <span>Subtotal</span>
              <span id="subtotal">â‚¹0.00</span>
            </div>
            <div class="summary-item">
              <span>Discount</span>
              <span id="discount">-â‚¹0.00</span>
            </div>
            <div class="summary-total">
              <span>Total</span>
              <span id="total">â‚¹0.00</span>
            </div>
          </div>

          <button type="submit" class="btn-book" id="book-btn" disabled>Proceed to Payment</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    let selectedTicket = null;
    let currentPrice = 0;
    
    function selectTicket(ticketId) {
      // Remove selected class from all tickets
      document.querySelectorAll('.ticket-option').forEach(ticket => {
        ticket.classList.remove('selected');
      });
      
      // Hide all quantity selectors
      document.querySelectorAll('.quantity-selector').forEach(qty => {
        qty.style.display = 'none';
      });
      
      // Select the clicked ticket
      const ticketElement = document.getElementById(`ticket-${ticketId}`);
      ticketElement.classList.add('selected');
      
      // Show quantity selector for selected ticket
      document.getElementById(`quantity-${ticketId}`).style.display = 'flex';
      
      // Set hidden form values
      document.getElementById('selected_ticket').value = ticketId;
      
      // Get ticket price
      const priceText = ticketElement.querySelector('.ticket-price').textContent;
      currentPrice = parseFloat(priceText.replace('â‚¹', ''));
      
      // Update totals
      updateTotals();
      
      // Enable book button
      document.getElementById('book-btn').disabled = false;
      
      selectedTicket = ticketId;
    }
    
    function increaseQuantity(ticketId) {
      const input = document.getElementById(`qty-${ticketId}`);
      const max = parseInt(input.max);
      if (parseInt(input.value) < max) {
        input.value = parseInt(input.value) + 1;
        updateQuantity(ticketId, input.value);
      }
    }
    
    function decreaseQuantity(ticketId) {
      const input = document.getElementById(`qty-${ticketId}`);
      if (parseInt(input.value) > 1) {
        input.value = parseInt(input.value) - 1;
        updateQuantity(ticketId, input.value);
      }
    }
    
    function updateQuantity(ticketId, quantity) {
      document.getElementById('ticket_quantity').value = quantity;
      updateTotals();
    }
    
    function updateTotals() {
      const quantity = selectedTicket ? parseInt(document.getElementById(`qty-${selectedTicket}`).value) : 0;
      const subtotal = currentPrice * quantity;
      
      document.getElementById('subtotal').textContent = `â‚¹${subtotal.toFixed(2)}`;
      document.getElementById('total').textContent = `â‚¹${subtotal.toFixed(2)}`;
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // If there's only one ticket type, select it automatically
      const ticketOptions = document.querySelectorAll('.ticket-option');
      if (ticketOptions.length === 1) {
        const ticketId = ticketOptions[0].id.split('-')[1];
        selectTicket(parseInt(ticketId));
      }
    });
  </script>
</body>
</html>